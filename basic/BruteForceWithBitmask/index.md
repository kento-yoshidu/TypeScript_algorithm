# ビット演算子とシフト演算子

ビット演算子とシフト演算子を用いれば、ある**整数**に対しビット単位で処理を行うことができます。

以前説明した通り、JavagScriptは内部的には浮動小数点数として数値を持っています。そしてある数値がビット演算子の計算にかけられた時、その数値は**32bitの符号付き整数に変換される**ことに注意が必要です。

> オペランドは 32 ビットの整数値に変換され、ビット (ゼロまたは 1) の並びによって表現されます。32 ビットを超える数値は最上位のビットが破棄されます。例えば、次の 32 ビットを超える整数は 32 ビット整数に変換されます。

参考 : [ビット論理積 (&amp;) - JavaScript | MDN](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Bitwise_AND)

つまり32bitを超えるような大きな数値を計算に用いる時には正しくない結果が得られる可能性があります。32bitの符号付き整数の最小値は`-2147483648`、最大値は`2147483647`ですので、これを超えるような演算を試しにしてみましょう。

ビットシフト演算子（`<<`や`>>`）に`0`を渡すことで、0ビットシフトを行い値を変えずに32bit整数に変換することができます。

```js
console.log((2147483645 >> 0));
//=> 2147483645
```

最大値である`2147483647`を超えた時から正しく結果が得られていないことがわかります。

```js
console.log((2147483646 >> 0));
//=> 2147483646

console.log((2147483647 >> 0));
//=> 2147483647
// ここが32bitの限界

console.log((2147483648 >> 0));
//=> -2147483648

console.log((2147483649 >> 0));
//=> -2147483647

console.log((2147483650 >> 0));
//=> -2147483646

console.log((2147483651 >> 0));
//=> -2147483645
```

## ある整数を2進数で出力する

`toString()`関数を使います。

```js
console.log((4).toString(2))
//=> 100

console.log((8).toString(2))
//=> 1000

console.log((16).toString(2))
//=> 10000

console.log((32).toString(2))
//=> 100000
```

## ビット論理和演算子

ビット論理和演算子(`&`)を使用すれば、ある数値をビット単位で比較し、全て`1`だったビットのみ`1`が出力されます。

`97 & 189`という式の結果は`33`になりますが、

```js
console.log(97 & 189)
//=> 33
```

`97`を2進数に変換すると`01100001`、`189`を2進数に変換すると`10111101`になります。両者の論理積をビット単位でとると`100001`であり、10進数なら`33`になる、というわけです。

|10進数|2進数|
|---|---|
|97|01<span style="color: red">1</span>0000<span style="color: red">1</span>|
|189|10<span style="color: red">1</span>1110<span style="color: red">1</span>|
|33|00<span style="color: red">1</span>0000<span style="color: red">1</span>|

```js
console.log((97 & 189).toString(2))
//=> 100001
```

なお、3つ以上のオペランドもとることができます。

```js
console.log(97 & 189 & 244)
//=>  32
```

|10進数|2進数|
|---|---|
|97|01<span style="color: red">1</span>00001|
|189|10<span style="color: red">1</span>11101|
|244|11<span style="color: red">1</span>10100|
|32|00<span style="color: red">1</span>00000|


## ビット論理和演算子

ビット論理和演算子(`|`)を使用すれば、ある数値をビット単位で比較し、いずれかが`1`だったビットにおいて`1`が出力されます。

```js
console.log((97 | 189))
//=> 253
```

|10進数|2進数|
|---|---|
|97|0<span style="color: red">11</span>0000<span style="color: red">1</span>|
|189|<span style="color: red">1</span>0<span style="color: red">1111</span>0<span style="color: red">1</span>|
|253|<span style="color: red">111111</span>0<span style="color: red">1</span>|

## ビット排他的論理和演算子

ビット排他的論理和演算子(^)を使用すれば、いずれか1つのビットだけが`1`だった場合のみ`1`が出力されます。

```js
console.log((97 ^ 189))
//=> 220
```

|10進数|2進数|
|---|---|
|97|0<span style="color: red">1</span>100001|
|189|<span style="color: red">1</span>01<span style="color: red">111</span>01|
|220|<span style="color: red">11</span>0<span style="color: red">111</span>00|

## ビット論理否定演算子

ある数値のビットを反転した値を返します。**2の補数**によって反転されるため、返ってくる値はその値に1を足して符号を反転させたものになります。

```js
console.log((~15))
//=> -16
// 15に1を足してマイナスにする

console.log((~-15))
//=> 14
// -15に1を足してプラスにする
```

http://nmi.jp/2022-01-24-Bitwise-operation-with-JavaScript
